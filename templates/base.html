<!DOCTYPE html>
<html lang="en" data-theme="{{ request.cookies.get('portal-theme', 'light') }}">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ title or "AI Recruitment Portal" }}</title>
  <meta name="description" content="AI Recruitment Portal â€” OTP login, candidate & recruiter dashboards, ML scoring" />
  <meta name="csrf-token" content="{{ csrf_token() if csrf_token is defined else '' }}" />

  <!-- Primary styles (portal.css will contain the system) -->
  <link rel="stylesheet" href="{{ url_for('static', path='portal.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', path='styles.css') }}" />

  <!-- Inline theme-init to avoid flash-of-unstyled-theme -->
  <script>
    (function(){
      try {
        const saved = localStorage.getItem('portal-theme');
        if(saved) document.documentElement.setAttribute('data-theme', saved);
      } catch(e){}
    })();
  </script>

  {% block head_extra %}{% endblock %}
  <style>
    /* Small safety fallback for environments without portal.css loaded yet */
    :root{--primary:#2563eb;--bg1:#f7fbff;--card:#fff;--text:#1f2937}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
  </style>
</head>
<body>
  <!-- Top navigation -->
  <header class="nav" role="banner">
    <div class="nav-inner container">
      <a href="{{ url_for('landing') }}" class="brand" aria-label="AI Recruitment Portal">
        <img src="{{ url_for('static', path='logo.svg') }}" alt="" class="brand-logo" />
        <span class="brand-text">AI Recruitment</span>
      </a>

      <nav class="nav-links" role="navigation" aria-label="Main">
        <a href="{{ url_for('landing') }}" class="nav-link">Home</a>
        <a href="{{ url_for('recruiter_dashboard') }}" class="nav-link">Recruiter</a>
        <a href="{{ url_for('candidate_dashboard') }}" class="nav-link">Candidate</a>
      </nav>

      <div class="nav-actions">
        <button id="theme-toggle" class="btn btn-ghost" aria-pressed="false" title="Toggle theme">ðŸŒ—</button>

        {% if user %}
          <div class="user-menu" aria-hidden="false">
            <span class="user-name">Hi, {{ user.name }}</span>
            <a href="{{ url_for('logout') }}" class="link-muted">Logout</a>
          </div>
        {% else %}
          <div class="auth-actions">
            <button id="open-auth" class="btn">Sign in / Sign up</button>
          </div>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- Flash -->
  {% if flash %}
    <div class="flash container" role="status">{{ flash }}</div>
  {% endif %}

  <!-- Main content area -->
  <main class="container site-main" role="main">
    {% block content %}{% endblock %}
  </main>

  <!-- Shared UI containers (modal root, toast root). JS mounts/populates here -->
  <div id="ui-roots">
    <!-- Modals are appended here by portal.js -->
    <div id="modal-root" aria-live="polite"></div>

    <!-- Toast container -->
    <div id="toast-root" aria-live="assertive" aria-atomic="true"></div>
  </div>

  <!-- Footer (simple) -->
  <footer class="site-footer">
    <div class="container footer-inner">
      <div class="footer-left">
        <small>Â© {{ now.year if now is defined else "2025" }} AI Recruitment Portal</small>
      </div>
      <div class="footer-right">
        <a class="link-muted" href="/privacy">Privacy</a>
        <a class="link-muted" href="/terms">Terms</a>
      </div>
    </div>
  </footer>

  <!-- Minimal inline behaviors that must run before deferred JS -->
  <script>
    // a11y: close dialogs with ESC globally (portal.js will add robust handling too)
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        const open = document.querySelector('.modal-backdrop.show, .modal-backdrop[aria-hidden="false"]');
        if (open) open.dispatchEvent(new CustomEvent('requestClose', { bubbles: true }));
      }
    });
  </script>

  <!-- Main script (deferred) -->
  <script defer src="{{ url_for('static', path='portal.js') }}"></script>
  {% block scripts_extra %}{% endblock %}
</body>
</html>
